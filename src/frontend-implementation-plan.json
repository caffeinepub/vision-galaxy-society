{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "IC mainnet redeploy workflow: live URL + canister ID output and failure remediation",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Ensure the IC mainnet retry-based deployment workflow reliably prints the live frontend URL and frontend canister ID on success.",
      "acceptanceCriteria": [
        "Running the deployment workflow completes a successful `dfx deploy --network ic` for the project.",
        "On success, the output clearly shows the frontend canister ID (e.g., from `dfx canister id frontend --network ic`).",
        "On success, the output clearly shows a live frontend URL (either `VITE_CANONICAL_APP_URL` when set, or `https://<frontend_canister_id>.ic0.app`)."
      ],
      "file_operations": [
        {
          "path": "frontend/deploy/ic-deploy-with-retry.sh",
          "operation": "modify",
          "description": "Harden the success output so it always prints (1) the frontend canister ID and (2) the live URL. Add safe environment loading for `VITE_CANONICAL_APP_URL` (e.g., from a local env file when present) so the canonical URL path is reliably used when configured, while keeping the default `https://<frontend_canister_id>.ic0.app` fallback."
        },
        {
          "path": "frontend/deploy/README.md",
          "operation": "modify",
          "description": "Update the deployment guide to explicitly document where the script prints the live frontend URL and the frontend canister ID, and how `VITE_CANONICAL_APP_URL` influences the printed URL."
        },
        {
          "path": "frontend/.env.example",
          "operation": "modify",
          "description": "Clarify how to set/export `VITE_CANONICAL_APP_URL` so the deployment script can print the canonical live URL on success."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "On mainnet redeploy failure, persist full attempt logs, classify canister reservation/creation failures vs generic failures, and print aligned remediation steps.",
      "acceptanceCriteria": [
        "For failed deployments, full stdout/stderr is saved to log files under `frontend/deploy/logs` for each attempt.",
        "Failure classification distinguishes canister reservation/creation failures (e.g., CaLM reservation issues, canister creation/reservation failures) from generic failures.",
        "When classified as canister reservation/creation failure, instructions include running `./frontend/deploy/ic-precreate-canisters.sh` and then rerunning `./frontend/deploy/ic-deploy-with-retry.sh` (or deploying directly with `dfx deploy --network ic`).",
        "When classified as generic failure, output provides the last error lines and points to `frontend/docs/deployment-troubleshooting.md` for further steps."
      ],
      "file_operations": [
        {
          "path": "frontend/deploy/ic-deploy-with-retry.sh",
          "operation": "modify",
          "description": "Ensure each deployment attempt writes complete stdout/stderr to `frontend/deploy/logs` (one file per attempt) and that the final failure output includes: (A) explicit classification as canister reservation/creation failure vs generic failure, (B) the last error lines for generic failures, and (C) clear next-step remediation instructions matching existing scripts (including `./frontend/deploy/ic-precreate-canisters.sh` and rerun with retries) plus a pointer to `frontend/docs/deployment-troubleshooting.md` for generic failures."
        },
        {
          "path": "frontend/docs/deployment-troubleshooting.md",
          "operation": "modify",
          "description": "Add/adjust troubleshooting guidance to mirror the scriptâ€™s failure classifications (canister reservation/creation including CaLM vs generic), explain where per-attempt logs are saved (`frontend/deploy/logs`), and reinforce the recommended remediation steps (pre-create canisters, rerun retry script, or run `dfx deploy --network ic`)."
        }
      ]
    }
  ]
}