{
  "kind": "build_request",
  "title": "Fix draft preview blank screen and add non-JS fallback diagnostics",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Ensure the app never renders as a fully blank page in Draft/Preview by adding an HTML-level startup fallback UI in frontend/index.html that is visible before React mounts and that automatically switches to an error state if the JS app does not bootstrap within a short timeout (e.g., 5â€“10 seconds). The fallback must include a plain HTML message, a standard reload action, and a hard-reload action that clears service worker + caches (best-effort) and then reloads.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "In draft it is now also showing blank"
        ]
      },
      "acceptanceCriteria": [
        "When opening the Draft/Preview URL, the user always sees either the React app or an HTML fallback screen; there is no fully blank/white screen state.",
        "If the JS bundle fails to load or React fails to mount, the HTML fallback switches to an error state within the configured timeout and shows Reload and Hard Reload (Clear Cache) actions.",
        "Hard Reload from the HTML fallback attempts to unregister service workers and clear Cache Storage, then reloads the page."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Add additional startup diagnostics to help identify why Draft is blank by logging critical bootstrap failures in a way that can be seen without React (e.g., console logging from index.html, plus rendering a short human-readable error hint in the HTML fallback when a script error/unhandled rejection occurs before React mounts). All user-facing text must be English.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "In draft it is now also showing blank"
        ]
      },
      "acceptanceCriteria": [
        "If an error occurs before React mounts, it is logged to the browser console and the HTML fallback shows a short English message indicating startup failed (without exposing sensitive data).",
        "If no error occurs and React mounts successfully, the HTML fallback is removed/hidden and does not visually interfere with the app."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Force service worker cache invalidation again to eliminate stale behavior affecting Draft/Preview by bumping the cache version in frontend/public/sw.js and confirming the fetch handler never returns cached index.html for non-navigation requests (scripts/styles/assets/modules).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "In draft it is now also showing blank"
        ]
      },
      "acceptanceCriteria": [
        "Service worker CACHE_NAME is updated to a new version string (e.g., vision-galaxy-v3).",
        "JS/CSS/module/image requests are never fulfilled by cached index.html; only true navigation/document requests may fall back to cached index.html.",
        "After a hard reload, the client installs/activates the new service worker cache version and the Draft/Preview page loads without a blank screen."
      ]
    }
  ],
  "constraints": [
    "Do not modify files under frontend/src/components/ui (read-only Shadcn components).",
    "Do not edit immutable hook/bootstrap files: frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx.",
    "Keep the backend as a single Motoko actor; no additional backend services."
  ],
  "nonGoals": [
    "Adding new product features unrelated to fixing the blank screen issue.",
    "Introducing third-party monitoring/analytics services or external logging backends."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}